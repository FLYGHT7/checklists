{% load static %}
{% load custom_i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" data-bs-theme="light">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta name="description" content="{% trans_tag 'DragTask - Organize your tasks with intuitive drag and drop interfaces. Create dynamic forms, checklists, and to-do lists.' %}">
 <title>{% block title %}{% trans_tag 'DragTask - Organize with Drag & Drop' %}{% endblock %}</title>
 
 <!-- Preconnect to external domains -->
 <link rel="preconnect" href="https://cdn.jsdelivr.net">
 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <!--icon-->
 <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236366f1' class='bi bi-grid-3x3-gap-fill' viewBox='0 0 16 16'><path d='M1 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1zM1 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1zM1 12a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1z'/></svg>" type="image/svg+xml">
 <!-- Critical CSS inline -->
 <style>
   /* Critical base styles */
   :root {
     --primary: #6366f1;
     --primary-dark: #4f46e5;
     --primary-light: #a5b4fc;
   }
   body {
     font-family: "Poppins", sans-serif;
     line-height: 1.6;
     margin: 0;
     padding: 0;
     display: flex;
     flex-direction: column;
     min-height: 100vh;
   }
   .header {
     background: linear-gradient(135deg, #00aaff, #0099cc);
     color: #ffffff;
     border-bottom: 2px solid rgba(0, 0, 0, 0.1);
   }
   [data-bs-theme="dark"] .header {
     background: linear-gradient(135deg, #2d3748, #1e293b);
     border-bottom: 2px solid rgba(255, 255, 255, 0.1);
   }
   .navbar-brand {
     font-weight: 700;
     font-size: 1.5rem;
     color: #ffffff;
   }
   .footer {
     background-color: #2d3748;
     color: white;
     margin-top: auto;
   }
   [data-bs-theme="dark"] .footer {
     background-color: #1a202c;
   }
   /* Estilos para el selector de idioma */
   .language-selector {
     position: relative;
     display: inline-flex;
     align-items: center;
   }
   .language-selector .dropdown-menu {
     min-width: 8rem;
     padding: 0.5rem 0;
     margin: 0;
     border-radius: 0.5rem;
   }
   .language-selector .dropdown-item {
     display: flex;
     align-items: center;
     padding: 0.5rem 1rem;
   }
   .language-selector .dropdown-item .flag-icon {
     margin-right: 0.5rem;
     font-size: 1.2rem;
   }
   .language-selector .dropdown-item.active {
     background-color: rgba(99, 102, 241, 0.1);
     color: var(--primary);
   }
   .language-selector .current-language {
     display: flex;
     align-items: center;
     color: white;
     text-decoration: none;
     padding: 0.5rem;
     border-radius: 0.5rem;
     transition: background-color 0.2s;
   }
   .language-selector .current-language:hover {
     background-color: rgba(255, 255, 255, 0.1);
   }
   .language-selector .current-language .flag-icon {
     margin-right: 0.25rem;
     font-size: 1.2rem;
   }
   .language-selector .current-language .language-name {
     margin-right: 0.25rem;
   }
   @media (max-width: 992px) {
     .language-selector-mobile {
       margin-top: 1rem;
       width: 100%;
       display: flex;
       justify-content: center;
     }
     .language-selector-mobile .btn-group {
       width: 100%;
     }
     .language-selector-mobile .btn {
       flex: 1;
       display: flex;
       justify-content: center;
       align-items: center;
     }
   }
 </style>
 
 <!-- Bootstrap CSS -->
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
 
 <!-- Bootstrap Icons -->
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
 
 <!-- Google Fonts -->
 <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" crossorigin>
 
 <!-- Base CSS -->
 <link rel="stylesheet" href="{% static 'css/base.css' %}">
 
 <!-- Navigation CSS -->
 <link rel="stylesheet" href="{% static 'css/navigation.css' %}">
 
 <!-- Page Specific CSS -->
 {% block styles %}{% endblock %}
</head>
<body class="d-flex flex-column min-vh-100">
 <!-- Debug info -->
 {% if debug %}
 <div style="position: fixed; bottom: 0; right: 0; background: rgba(0,0,0,0.7); color: white; padding: 5px; z-index: 9999; font-size: 12px;">
   LANGUAGE_CODE: {{ LANGUAGE_CODE }}
 </div>
 {% endif %}

 <!-- Header -->
 <header class="header sticky-top">
   <nav class="navbar navbar-expand-lg">
     <div class="container">
       <a class="navbar-brand d-flex align-items-center" href="/">
         <i class="bi bi-grid-3x3-gap-fill me-2" aria-hidden="true"></i>
         <span>DragTask</span>
       </a>
       <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
       </button>
       <div class="collapse navbar-collapse" id="navbarNav">
         <ul class="navbar-nav mx-auto">
           {% if request.path == '/' %}
             <!-- Enlaces para la página de inicio -->
             <li class="nav-item">
               <a class="nav-link" href="#features">{% trans_tag "Features" %}</a>
             </li>
             <li class="nav-item">
               <a class="nav-link" href="#how-it-works">{% trans_tag "How It Works" %}</a>
             </li>
             <li class="nav-item">
               <a class="nav-link" href="#pricing">{% trans_tag "Pricing" %}</a>
             </li>
           {% else %}
             <!-- Enlaces para otras páginas -->
             <li class="nav-item">
               <a class="nav-link" href="{% url 'dashboard' %}">
                 <i class="bi bi-speedometer2 me-1" aria-hidden="true"></i>{% trans_tag "Dashboard" %}
               </a>
             </li>
             <li class="nav-item">
               <a class="nav-link" href="{% url 'todo_lists' %}">
                 <i class="bi bi-list-check me-1" aria-hidden="true"></i>{% trans_tag "Todo Lists" %}
               </a>
             </li>
             <li class="nav-item">
               <a class="nav-link" href="{% url 'gform_list' %}">
                 <i class="bi bi-file-earmark-text me-1" aria-hidden="true"></i>{% trans_tag "Forms" %}
               </a>
             </li>
           {% endif %}
         </ul>
         <div class="d-flex gap-3 align-items-center">
           <!-- Selector de idioma para desktop -->
           <div class="language-selector dropdown d-none d-lg-block">
             <a class="current-language dropdown-toggle" href="#" role="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
               {% if LANGUAGE_CODE == 'es' %}
                 <i class="flag-icon bi bi-globe-americas" aria-hidden="true"></i>
                 <span class="language-name">ES</span>
               {% else %}
                 <i class="flag-icon bi bi-globe-americas" aria-hidden="true"></i>
                 <span class="language-name">EN</span>
               {% endif %}
             </a>
             <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
               <form action="{% url 'change_language' %}" method="post" id="language-form-es">
                 {% csrf_token %}
                 <input name="next" type="hidden" value="{{ request.path }}">
                 <input name="language" type="hidden" value="es">
                 <li>
                   <button type="submit" class="dropdown-item {% if LANGUAGE_CODE == 'es' %}active{% endif %}">
                     <i class="flag-icon bi bi-globe-americas" aria-hidden="true"></i>
                     {% trans_tag "Spanish" %}
                   </button>
                 </li>
               </form>
               <form action="{% url 'change_language' %}" method="post" id="language-form-en">
                 {% csrf_token %}
                 <input name="next" type="hidden" value="{{ request.path }}">
                 <input name="language" type="hidden" value="en">
                 <li>
                   <button type="submit" class="dropdown-item {% if LANGUAGE_CODE == 'en' %}active{% endif %}">
                     <i class="flag-icon bi bi-globe-americas" aria-hidden="true"></i>
                     {% trans_tag "English" %}
                   </button>
                 </li>
               </form>
             </ul>
           </div>
           
           {% if user.is_authenticated %}
             <!-- Desktop View -->
             <div class="dropdown d-none d-lg-block">
               <a class="user-avatar dropdown-toggle" href="#" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                 <div class="avatar-circle">
                   <span class="avatar-initials">{{ user.username|slice:":2"|upper }}</span>
                 </div>
               </a>
               <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                 <li class="dropdown-user-info">
                   <div class="px-3 py-2">
                     <div class="fw-bold">{{ user.username }}</div>
                     <div class="small text-muted">{{ user.email }}</div>
                   </div>
                 </li>
                 <li><hr class="dropdown-divider"></li>
                 {% if request.path == '/' %}
                   <li>
                     <a class="dropdown-item" href="{% url 'dashboard' %}">
                       <i class="bi bi-speedometer2 me-2" aria-hidden="true"></i>{% trans_tag "Dashboard" %}
                     </a>
                   </li>
                   <li>
                     <a class="dropdown-item" href="{% url 'todo_lists' %}">
                       <i class="bi bi-list-check me-2" aria-hidden="true"></i>{% trans_tag "My Tasks" %}
                     </a>
                   </li>
                   <li><hr class="dropdown-divider"></li>
                 {% endif %}
                 <li>
                   <form action="{% url 'logout' %}" method="post" class="dropdown-item-form">
                     {% csrf_token %}
                     <button type="submit" class="dropdown-item text-danger">
                       <i class="bi bi-box-arrow-right me-2" aria-hidden="true"></i>{% trans_tag "Logout" %}
                     </button>
                   </form>
                 </li>
               </ul>
             </div>
             
             <!-- Mobile View -->
             <div class="d-block d-lg-none w-100 mt-3">
               <div class="mobile-user-info p-3 rounded">
                 <div class="d-flex align-items-center">
                   <div class="avatar-circle me-3">
                     <span class="avatar-initials">{{ user.username|slice:":2"|upper }}</span>
                   </div>
                   <div>
                     <div class="fw-bold">{{ user.username }}</div>
                     <div class="small text-muted">{{ user.email }}</div>
                   </div>
                 </div>
               </div>
               <div class="d-flex flex-column gap-2 mt-3">
                 {% if request.path == '/' %}
                   <a href="{% url 'dashboard' %}" class="btn btn-outline-light w-100">
                     <i class="bi bi-speedometer2 me-2" aria-hidden="true"></i>{% trans_tag "Dashboard" %}
                   </a>
                   <a href="{% url 'todo_lists' %}" class="btn btn-outline-light w-100">
                     <i class="bi bi-list-check me-2" aria-hidden="true"></i>{% trans_tag "My Tasks" %}
                   </a>
                 {% endif %}
                 <form action="{% url 'logout' %}" method="post" class="w-100">
                   {% csrf_token %}
                   <button type="submit" class="btn btn-danger w-100">
                     <i class="bi bi-box-arrow-right me-2" aria-hidden="true"></i>{% trans_tag "Logout" %}
                   </button>
                 </form>
               </div>
             </div>
           {% else %}
             <!-- Login/Register Buttons -->
             <div class="d-flex flex-column flex-lg-row gap-2">
               <a href="{% url 'login' %}" class="btn btn-primary">{% trans_tag "Log in" %}</a>
               <a href="{% url 'register' %}" class="btn btn-primary">{% trans_tag "Sign Up" %}</a>
             </div>
           {% endif %}
           
           <!-- Botón de modo oscuro - visible on desktop -->
           <button id="dark-mode-toggle" class="btn btn-outline-light d-flex align-items-center justify-content-center d-none d-lg-flex" aria-label="Toggle dark mode">
             <i id="toggle-icon" class="bi bi-moon-fill fs-4" aria-hidden="true"></i>
           </button>
         </div>

         <!-- Selector de idioma para móvil -->
         <div class="language-selector-mobile d-lg-none">
           <div class="btn-group w-100" role="group" aria-label="{% trans_tag 'Language selector' %}">
             <form action="{% url 'change_language' %}" method="post" class="w-50">
               {% csrf_token %}
               <input name="next" type="hidden" value="{{ request.path }}">
               <input name="language" type="hidden" value="es">
               <button type="submit" class="btn w-100 {% if LANGUAGE_CODE == 'es' %}btn-primary{% else %}btn-outline-light{% endif %}">
                 <i class="flag-icon bi bi-globe-americas me-1" aria-hidden="true"></i>ES
               </button>
             </form>
             <form action="{% url 'change_language' %}" method="post" class="w-50">
               {% csrf_token %}
               <input name="next" type="hidden" value="{{ request.path }}">
               <input name="language" type="hidden" value="en">
               <button type="submit" class="btn w-100 {% if LANGUAGE_CODE == 'en' %}btn-primary{% else %}btn-outline-light{% endif %}">
                 <i class="flag-icon bi bi-globe-americas me-1" aria-hidden="true"></i>EN
               </button>
             </form>
           </div>
         </div>

         <!-- Add the dark mode toggle button at the end of the mobile menu -->
         <button id="dark-mode-toggle-mobile" class="btn btn-outline-light d-flex align-items-center justify-content-center mt-3 mx-auto d-lg-none" aria-label="Toggle dark mode">
           <i id="toggle-icon-mobile" class="bi bi-moon-fill fs-4" aria-hidden="true"></i>
         </button>
       </div>
     </div>
   </nav>
 </header>

 <!-- Main Content -->
 {% block content %}{% endblock %}

 <!-- Footer -->
 <footer class="footer py-5 mt-auto">
   <div class="container">
     <div class="row g-4 mb-4">
       <div class="col-lg-4">
         <div class="footer-brand d-flex align-items-center mb-3">
           <i class="bi bi-grid-3x3-gap-fill me-2" aria-hidden="true"></i>
           <span>DragTask</span>
         </div>
         <p>{% trans_tag "Organize your tasks with intuitive drag and drop." %}</p>
         <div class="social-links">
           <a href="#" aria-label="Facebook"><i class="bi bi-facebook" aria-hidden="true"></i></a>
           <a href="#" aria-label="Twitter"><i class="bi bi-twitter-x" aria-hidden="true"></i></a>
           <a href="#" aria-label="Instagram"><i class="bi bi-instagram" aria-hidden="true"></i></a>
           <a href="#" aria-label="LinkedIn"><i class="bi bi-linkedin" aria-hidden="true"></i></a>
         </div>
       </div>
       <div class="col-lg-8">
         <div class="row g-4">
           <div class="col-6 col-md-4">
             <h5>{% trans_tag "Product" %}</h5>
             <ul class="list-unstyled">
               <li><a href="#features">{% trans_tag "Features" %}</a></li>
               <li><a href="#pricing">{% trans_tag "Pricing" %}</a></li>
               <li><a href="#">{% trans_tag "Testimonials" %}</a></li>
               <li><a href="#">{% trans_tag "Integrations" %}</a></li>
             </ul>
           </div>
           <div class="col-6 col-md-4">
             <h5>{% trans_tag "Company" %}</h5>
             <ul class="list-unstyled">
               <li><a href="#">{% trans_tag "About" %}</a></li>
               <li><a href="#">{% trans_tag "Blog" %}</a></li>
               <li><a href="#">{% trans_tag "Careers" %}</a></li>
               <li><a href="#">{% trans_tag "Contact" %}</a></li>
             </ul>
           </div>
           <div class="col-6 col-md-4">
             <h5>{% trans_tag "Legal" %}</h5>
             <ul class="list-unstyled">
               <li><a href="#">{% trans_tag "Terms" %}</a></li>
               <li><a href="#">{% trans_tag "Privacy" %}</a></li>
               <li><a href="#">{% trans_tag "Cookies" %}</a></li>
               <li><a href="#">{% trans_tag "Licenses" %}</a></li>
             </ul>
           </div>
         </div>
       </div>
     </div>
     <div class="footer-bottom pt-4 border-top">
       <div class="row">
         <div class="col-md-6">
           <p class="mb-0">&copy; 2025 DragTask. {% trans_tag "All rights reserved." %}</p>
         </div>
         <div class="col-md-6 text-md-end">
           <a href="#" class="text-decoration-none me-3">{% trans_tag "Terms" %}</a>
           <a href="#" class="text-decoration-none">{% trans_tag "Privacy" %}</a>
         </div>
       </div>
     </div>
   </div>
 </footer>

 <!-- Bootstrap JS -->
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 
 <!-- Dark Mode JS -->
 <script src="{% static 'js/darkmode-toggle.js' %}"></script>
 
 <!-- Script para mantener el tema al recargar o redirigir -->
 <script>
   // Apply saved theme immediately to prevent flash of wrong theme
   (function() {
     const savedTheme = localStorage.getItem("theme");
     if (savedTheme) {
       document.documentElement.setAttribute("data-bs-theme", savedTheme);
     }
   })();
   
   // Full theme initialization after DOM is loaded
   window.addEventListener("DOMContentLoaded", () => {
     const savedTheme = localStorage.getItem("theme");
     if (savedTheme) {
       // Update icons based on theme
       const icons = [document.getElementById("toggle-icon"), document.getElementById("toggle-icon-mobile")];
       
       icons.forEach(icon => {
         if (icon) {
           if (savedTheme === "dark") {
             icon.classList.remove("bi-moon-fill");
             icon.classList.add("bi-sun-fill");
           } else {
             icon.classList.remove("bi-sun-fill");
             icon.classList.add("bi-moon-fill");
           }
         }
       });
     }
   });
 </script>
 
 <!-- Script para depurar el cambio de idioma -->
 <script>
   document.addEventListener('DOMContentLoaded', function() {
     // Mostrar información de depuración en la consola
     console.log('Current language code:', '{{ LANGUAGE_CODE }}');
     
     // Añadir event listeners a los formularios de cambio de idioma
     const langFormEs = document.getElementById('language-form-es');
     const langFormEn = document.getElementById('language-form-en');
     
     if (langFormEs) {
       langFormEs.addEventListener('submit', function() {
         console.log('Changing language to ES');
       });
     }
     
     if (langFormEn) {
       langFormEn.addEventListener('submit', function() {
         console.log('Changing language to EN');
       });
     }
   });
 </script>
 
 <!-- Page Specific Scripts -->
 {% block scripts %}{% endblock %}
</body>
</html>